!function(){var a=angular.module("holdemApp",["ngRoute","ngAnimate","holdemFilters","holdemControllers","holdemServices","holdemDirectives","holdemConstants"]);a.config(["$routeProvider","$locationProvider",function(a,b){a.when("/game",{templateUrl:"/partials/game",controller:"GameCtrl"}).otherwise({redirectTo:"/game"}),b.html5Mode(!0)}])}(window),function(){var a=angular.module("holdemControllers",[]);a.controller("GameCtrl",["$scope","gameService","uiService","HOLDEM_EVENTS",function(a,b,c,d){a.gameStarted=!1,a.handNr=null,a.addPlayer=function(){c.promptForInput("Player name","Add player","Cancel",function(c,d){c&&(b.addPlayer({name:d,stack:1500}),a.players=b.players)})},a.startGame=function(){b.startGame()},a.nextHand=function(){b.nextHand()},a.advanceBettingRound=function(){b.advanceBettingRound()},a.$on(d.GAME_STARTED,function(){a.gameStarted=!0}),a.$on(d.NEXT_HAND_DEALT,function(b,c){a.handNr=c}),a.$on(d.BETTING_ROUND_ADVANCED,function(b,c){a.currentBettingRound=c})}])}(window),function(){var a=angular.module("holdemDirectives",[]);a.directive("playerPanel",[function(){return{restrict:"E",templateUrl:"/partials/player-panel",replace:!0,scope:{seatNr:"=seatNr"},controller:["$scope","$timeout","gameService","HOLDEM_EVENTS",function(a,b,c,d){function e(a){var b=a[g];f(b)}function f(c){b(function(){a.player=c})}var g=a.seatNr-1;a.isDealer=!1,a.isSmallBlind=!1,a.isBigBlind=!1,a.deletePlayer=function(){c.deletePlayer(g)},a.isGameStarted=function(){return c.gameStarted},a.$on(d.PLAYER_ADDED,function(a,b){e(b)}),a.$on(d.PLAYER_DELETED,function(a,b){e(b)}),a.$on(d.ROLES_ASSIGNED,function(b,c){a.isDealer=g===c.dealer,a.isSmallBlind=g===c.smallBlind,a.isBigBlind=g===c.bigBlind}),a.$on(d.ACTION_PERFORMED,function(b,c){c.player===g&&(a.mostRecentAction=c)}),a.$on(d.TURN_ASSIGNED,function(a,b){b===g&&console.log("It is our player's turn ("+b+")")})}]}}])}(window),function(){var a=angular.module("holdemFilters",[]);a.filter("stackSize",[function(){return function(a){return"number"==typeof a?"Stack size: "+a:void 0}}]),a.filter("handNrFilter",[function(){return function(a){return"number"==typeof a?"Hand #"+a:void 0}}]),a.filter("playerAction",[function(){return function(a){return a?a.action+" "+a.amount:void 0}}]),a.filter("bettingRound",["HOLDEM_BETTING_ROUNDS",function(a){return function(b){if(b){var c;switch(b){case a.PRE_FLOP:c="PRE-FLOP";break;case a.FLOP:c="FLOP";break;case a.TURN:c="TURN";break;case a.RIVER:c="RIVER";break;default:throw"Illegal betting round"}return"Current betting round: "+c}}}])}(window),function(a,b){var c=angular.module("holdemServices",[]);c.service("gameService",["$rootScope","HOLDEM_EVENTS","HOLDEM_ACTIONS","HOLDEM_BETTING_ROUNDS",function(a,c,d,e){function f(){var b=k.getCurrentHand(),d=k.getPreviousHand();b.roles=d?{dealer:(d.roles.dealer+1)%k.players.length,smallBlind:(d.roles.smallBlind+1)%k.players.length,bigBlind:(d.roles.bigBlind+1)%k.players.length}:k.players.length>2?{dealer:0,smallBlind:1,bigBlind:2}:{dealer:0,smallBlind:0,bigBlind:1},a.$broadcast(c.ROLES_ASSIGNED,b.roles)}function g(){if(k.isCurrentBettingRoundFinished())k.whoseTurnItIs=i();else{var b=k.getLastAction().player;k.whoseTurnItIs=j(b,!1)}a.$broadcast(c.TURN_ASSIGNED,k.whoseTurnItIs)}function h(){var b=k.getCurrentHand(),f={player:b.roles.smallBlind,action:d.BET,amount:b.blinds.smallBlind,bettingRound:e.PRE_FLOP},g={player:b.roles.bigBlind,action:d.RAISE,amount:b.blinds.bigBlind,bettingRound:e.PRE_FLOP};b.actions=[f,g],a.$broadcast(c.ACTION_PERFORMED,f),a.$broadcast(c.ACTION_PERFORMED,g)}function i(){{var a=k.getCurrentHand();a.roles.smallBlind}return j(smallBlind,!0)}function j(a,b){for(var c,d=b?0:1,e=a+d;e<a+k.players.length-1;e++)if(c=e%k.players.length,!k.isPlayerFinished(c))return c;throw"No unfinished player found"}var k=this;this.players=[],this.finishedPlayers=[],this.allHands=[],this.gameStarted=!1,this.currentBettingRound=null,this.whoseTurnItIs=b,this.addPlayer=function(b){b.name=b.name||"Player "+(this.players.length+1),b.stack=b.stack||1500,this.players.push(b),a.$broadcast(c.PLAYER_ADDED,this.players)},this.deletePlayer=function(b){this.players.splice(b,1),a.$broadcast(c.PLAYER_DELETED,this.players)},this.isPlayerFinished=function(a){return this.finishedPlayers.indexOf(a)>-1},this.startGame=function(){this.gameStarted=!0,this.currentBettingRound=e.PRE_FLOP,this.nextHand(),a.$broadcast(c.GAME_STARTED),a.$broadcast(c.BETTING_ROUND_ADVANCED,this.currentBettingRound)},this.nextHand=function(){var b=this.allHands.length+1;this.allHands.push({handNr:b,blinds:{smallBlind:10,bigBlind:20}}),f(),h(),g(),a.$broadcast(c.NEXT_HAND_DEALT,b)},this.advanceBettingRound=function(){if(!isCurrentBettingRoundFinished())throw"Current betting round wasn't yet finished";switch(this.currentBettingRound){case e.PRE_FLOP:this.currentBettingRound=e.FLOP;break;case e.FLOP:this.currentBettingRound=e.TURN;break;case e.TURN:this.currentBettingRound=e.RIVER;break;case e.RIVER:throw"There is no betting round after the river"}a.$broadcast(c.BETTING_ROUND_ADVANCED,this.currentBettingRound)},this.getCurrentHand=function(){return this.allHands.length<1?null:this.allHands[this.allHands.length-1]},this.getPreviousHand=function(){return this.allHands.length<2?null:this.allHands[this.allHands.length-2]},this.recordAction=function(b){return b.player&&b.action?(b.bettingRound=this.currentBettingRound,getCurrentHand().actions.push(b),void a.$broadcast(c.ACTION_PERFORMED,b)):!1},this.isCurrentBettingRoundFinished=function(){},this.getLastAction=function(){var a=k.getCurrentHand();if(!a.actions||!a.actions.length)throw"No actions yet in current hand";return a.actions[a.actions.length-1]}}]),c.factory("uiService",[function(){return{successMessage:function(a){alertify.success(a)},errorMessage:function(a){alertify.error(a)},infoMessage:function(a){alertify.info(a)},promptForInput:function(a,b,c,d){alertify.set({labels:{ok:b,cancel:c}}),alertify.prompt(a,d)}}}])}(window),function(){var a=angular.module("holdemConstants",[]);a.constant("HOLDEM_EVENTS",{GAME_STARTED:"gameStarted",PLAYER_ADDED:"playerAdded",PLAYER_DELETED:"playerDeleted",NEXT_HAND_DEALT:"nextHandDealt",ROLES_ASSIGNED:"rolesAssigned",ACTION_PERFORMED:"actionPerformed",BETTING_ROUND_ADVANCED:"bettingRoundAdvanced",TURN_ASSIGNED:"turnAssigned"}),a.constant("HOLDEM_ACTIONS",{FOLD:"fold",CALL:"call",RAISE:"raise",BET:"bet",CHECK:"check"}),a.constant("HOLDEM_BETTING_ROUNDS",{PRE_FLOP:"pre_flop",FLOP:"flop",TURN:"turn",RIVER:"river"})}(window);
//# sourceMappingURL=blogApp.min.js.map